# ë°±í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

## ğŸ“Š ë°±í…ŒìŠ¤íŠ¸ë€?

ë°±í…ŒìŠ¤íŠ¸(Backtest)ëŠ” ì „ëµì„ ê³¼ê±° ë°ì´í„°ì— ì ìš©í•˜ì—¬ ì„±ê³¼ë¥¼ ê²€ì¦í•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤.

### ì™œ ë°±í…ŒìŠ¤íŠ¸ê°€ í•„ìš”í•œê°€?
- âœ… ì „ëµì˜ ìˆ˜ìµì„± ê²€ì¦
- âœ… ë¦¬ìŠ¤í¬ íŒŒì•… (ìµœëŒ€ ë‚™í­ ë“±)
- âœ… íŒŒë¼ë¯¸í„° ìµœì í™”
- âœ… ì‹¤ì „ íˆ¬ì ì „ ì‹ ë¢°ë„ í™•ë³´

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

> ğŸ’¡ **ë” ìì„¸í•œ ë‚´ìš©ì€ [backtest/QUICKSTART.md](backtest/QUICKSTART.md)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.**

### 1. ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰

**3ê°€ì§€ ë°ì´í„° ì†ŒìŠ¤ ì¤‘ ì„ íƒ:**

```bash
# trading_bot í´ë”ì—ì„œ ì‹¤í–‰
cd trading_bot

# ë°©ë²• 1: FinanceDataReader (ê¶Œì¥ - ë¬´ë£Œ, ë¬´ì œí•œ)
uv run run_backtest.py --source fdr --start 20220101 --end 20241231

# ë°©ë²• 2: KIS API (ìµœê·¼ 100ê±°ë˜ì¼)
uv run run_backtest.py --source api

# ë°©ë²• 3: ì™¸ë¶€ DB (ë¬´ì œí•œ, ì˜¤í”„ë¼ì¸ ê°€ëŠ¥)
uv run run_backtest.py --source db --db-path backtest_data.db --start 20200101
```

### 2. ì£¼ìš” ì˜µì…˜

```bash
--source {api|db|fdr}    # ë°ì´í„° ì†ŒìŠ¤ ì„ íƒ (ê¸°ë³¸ê°’: fdr)
--start YYYYMMDD         # ì‹œì‘ì¼ (ê¸°ë³¸ê°’: 2ë…„ ì „)
--end YYYYMMDD           # ì¢…ë£Œì¼ (ê¸°ë³¸ê°’: ì–´ì œ)
--symbols 005930 000660  # ì¢…ëª© ì§€ì • (ê¸°ë³¸ê°’: Config.WATCH_LIST)
--capital 10000000       # ì´ˆê¸° ìë³¸ê¸ˆ (ê¸°ë³¸ê°’: 1ì²œë§Œì›)
--short-period 5         # ë‹¨ê¸° ì´ë™í‰ê·  (ê¸°ë³¸ê°’: 5)
--long-period 20         # ì¥ê¸° ì´ë™í‰ê·  (ê¸°ë³¸ê°’: 20)
```

### 3. ê²°ê³¼ í™•ì¸

ì‹¤í–‰ í›„ ë‹¤ìŒ ì •ë³´ê°€ ì¶œë ¥ë©ë‹ˆë‹¤:
- ğŸ“… ë°±í…ŒìŠ¤íŠ¸ ê¸°ê°„
- ğŸ’° ì´ˆê¸°/ìµœì¢… ìë³¸, ìˆ˜ìµë¥ 
- ğŸ“Š MDD, ìƒ¤í”„ë¹„ìœ¨
- ğŸ“ˆ ê±°ë˜ í†µê³„ (ìŠ¹ë¥ , ì†ìµë¹„ ë“±)

### 4. ê²°ê³¼ íŒŒì¼

`backtest_results/` ë””ë ‰í† ë¦¬ì— ì €ì¥:

```
backtest_results/
â”œâ”€â”€ ma_crossover_fdr_chart_20260106_144425.png    # ê·¸ë˜í”„
â”œâ”€â”€ ma_crossover_fdr_equity_20260106_144425.csv   # ìì‚° ê³¡ì„ 
â””â”€â”€ ma_crossover_fdr_trades_20260106_144425.csv   # ê±°ë˜ ë‚´ì—­
```

íŒŒì¼ëª… ê·œì¹™: `{ì „ëµëª…}_{ë°ì´í„°ì†ŒìŠ¤}_{íƒ€ì…}_{ë‚ ì§œ}_{ì‹œê°„}.{í™•ì¥ì}`

## ğŸ“š ë°ì´í„° ì†ŒìŠ¤ ë¹„êµ

> ğŸ’¡ **ìƒì„¸ ë¹„êµëŠ” [backtest/DATA_SOURCES.md](backtest/DATA_SOURCES.md)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.**

| ë°ì´í„° ì†ŒìŠ¤ | ê¸°ê°„ ì œí•œ | ì„¤ì¹˜ í•„ìš” | ì¸í„°ë„· | ì¥ì  |
|------------|----------|----------|--------|------|
| **api** | ìµœê·¼ 100ì¼ | âŒ | âœ… | KIS API í…ŒìŠ¤íŠ¸ ê²¸ìš© |
| **db** | ë¬´ì œí•œ | DB ìƒì„± | âŒ | ì˜¤í”„ë¼ì¸ ê°€ëŠ¥, ë¹ ë¦„ |
| **fdr** | ë¬´ì œí•œ | `uv pip install finance-datareader` | âœ… | í•œêµ­ ì£¼ì‹ ìµœì í™”, ë¬´ë£Œ |

**ê¶Œì¥ ìˆœì„œ:**
1. FDRë¡œ ë¹ ë¥¸ ê²€ì¦
2. ì¥ê¸° ë°±í…ŒìŠ¤íŠ¸ í•„ìš” ì‹œ ì™¸ë¶€ DB ìƒì„±
3. KIS APIëŠ” 100ì¼ ì œí•œìœ¼ë¡œ ê°„ë‹¨ í…ŒìŠ¤íŠ¸ìš©

## âš™ï¸ ì„¤ì • ë³€ê²½

### ëª…ë ¹í–‰ ì˜µì…˜ìœ¼ë¡œ ë³€ê²½ (ê¶Œì¥)

```bash
# ì¢…ëª© ë³€ê²½
uv run run_backtest.py --symbols 005930 000660 035720

# ì „ëµ íŒŒë¼ë¯¸í„° ë³€ê²½
uv run run_backtest.py --short-period 3 --long-period 10

# ì´ˆê¸° ìë³¸ê¸ˆ ë³€ê²½
uv run run_backtest.py --capital 20000000

# ì¢…í•© ì˜ˆì‹œ
uv run run_backtest.py --source fdr --start 20200101 --symbols 005930 --capital 50000000
```

### config.pyì—ì„œ ê¸°ë³¸ê°’ ì„¤ì •

```python
# ë°±í…ŒìŠ¤íŠ¸ ì„¤ì •
BACKTEST_INITIAL_CAPITAL = 10000000  # ì´ˆê¸° ìë³¸ê¸ˆ
BACKTEST_COMMISSION_RATE = 0.00015   # ìˆ˜ìˆ˜ë£Œìœ¨ (0.015%)
BACKTEST_SLIPPAGE_RATE = 0.001       # ìŠ¬ë¦¬í”¼ì§€ (0.1%)

# ê¸°ë³¸ ê°ì‹œ ì¢…ëª©
WATCH_LIST = [
    "005930",  # ì‚¼ì„±ì „ì
    "000660",  # SKí•˜ì´ë‹‰ìŠ¤
]

# ì „ëµ íŒŒë¼ë¯¸í„° (ëª…ë ¹í–‰ì—ì„œ override ê°€ëŠ¥)
MA_SHORT_PERIOD = 5   # ë‹¨ê¸° ì´ë™í‰ê· 
MA_LONG_PERIOD = 20   # ì¥ê¸° ì´ë™í‰ê· 
```

## ğŸ“ˆ ì„±ê³¼ ì§€í‘œ ì„¤ëª…

### ìˆ˜ìµë¥  ì§€í‘œ
- **ì´ ìˆ˜ìµë¥ **: (ìµœì¢…ìë³¸ - ì´ˆê¸°ìë³¸) / ì´ˆê¸°ìë³¸ Ã— 100
- **CAGR**: ì—°í‰ê·  ë³µë¦¬ ìˆ˜ìµë¥ 
- **í‰ê·  ì†ìµ**: ê±°ë˜ë‹¹ í‰ê·  ì†ìµ

### ë¦¬ìŠ¤í¬ ì§€í‘œ
- **MDD (Maximum Drawdown)**: ìµœëŒ€ ë‚™í­
  - ê³ ì  ëŒ€ë¹„ ìµœëŒ€ í•˜ë½í­
  - ë‚®ì„ìˆ˜ë¡ ì•ˆì •ì 
- **ìƒ¤í”„ ë¹„ìœ¨**: ìœ„í—˜ ëŒ€ë¹„ ìˆ˜ìµë¥ 
  - ë†’ì„ìˆ˜ë¡ íš¨ìœ¨ì 
  - 1.0 ì´ìƒì´ë©´ ì–‘í˜¸, 2.0 ì´ìƒì´ë©´ ìš°ìˆ˜

### ê±°ë˜ í†µê³„
- **ìŠ¹ë¥ **: ìˆ˜ìµ ê±°ë˜ ë¹„ìœ¨
- **ì†ìµë¹„**: ì´ ì´ìµ / ì´ ì†ì‹¤
  - 1.0 ì´ìƒì´ë©´ ì–‘í˜¸
- **ì´ ê±°ë˜ íšŸìˆ˜**: ë§¤ë§¤ ë¹ˆë„

## ğŸ’¡ ì‚¬ìš© ì˜ˆì‹œ

### ì˜ˆì‹œ 1: ë‹¤ë¥¸ ì¢…ëª©ìœ¼ë¡œ í…ŒìŠ¤íŠ¸

```bash
# ì‚¼ì„±ì „ìë§Œ
uv run run_backtest.py --symbols 005930

# ì—¬ëŸ¬ ì¢…ëª©
uv run run_backtest.py --symbols 005380 051910 035720
```

### ì˜ˆì‹œ 2: íŒŒë¼ë¯¸í„° ìµœì í™”

```bash
# ë‹¨ê¸° 3ì¼, ì¥ê¸° 10ì¼
uv run run_backtest.py --short-period 3 --long-period 10

# ë‹¨ê¸° 5ì¼, ì¥ê¸° 20ì¼ (ê¸°ë³¸ê°’)
uv run run_backtest.py --short-period 5 --long-period 20

# ë‹¨ê¸° 10ì¼, ì¥ê¸° 50ì¼
uv run run_backtest.py --short-period 10 --long-period 50
```

ê²°ê³¼ë¥¼ ë¹„êµí•˜ì—¬ ìµœì  íŒŒë¼ë¯¸í„° ì„ íƒ

### ì˜ˆì‹œ 3: ê¸´ ê¸°ê°„ í…ŒìŠ¤íŠ¸

```bash
# FDRë¡œ 5ë…„ ë°±í…ŒìŠ¤íŠ¸
uv run run_backtest.py --source fdr --start 20190101 --end 20241231

# ì™¸ë¶€ DBë¡œ 10ë…„ ë°±í…ŒìŠ¤íŠ¸
uv run create_external_db.py  # DB ë¨¼ì € ìƒì„±
uv run run_backtest.py --source db --db-path backtest_data.db --start 20140101
```

### ì˜ˆì‹œ 4: ì™¸ë¶€ DB ìƒì„± ë° ì‚¬ìš©

> ğŸ’¡ **ìƒì„¸ ê°€ì´ë“œëŠ” [backtest/DB_GUIDE.md](backtest/DB_GUIDE.md)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.**

```bash
# 1. DB ìƒì„±
uv run create_external_db.py

# 2. DBë¡œ ë°±í…ŒìŠ¤íŠ¸
uv run run_backtest.py --source db --db-path backtest_data.db --start 20200101
```

## ğŸ“Š ê²°ê³¼ ë¶„ì„ ë°©ë²•

### 1. ìì‚° ê³¡ì„  í™•ì¸
- ì§€ì†ì  ìƒìŠ¹: ì•ˆì •ì  ì „ëµ
- ë³€ë™ì„± í¼: ë¦¬ìŠ¤í¬ ë†’ìŒ
- í•˜ë½ ì§€ì†: ì „ëµ ê°œì„  í•„ìš”

### 2. MDD í™•ì¸
- 10% ë¯¸ë§Œ: ì–‘í˜¸
- 10-20%: ë³´í†µ
- 20% ì´ìƒ: ì£¼ì˜ (ì†ì ˆ ì „ëµ í•„ìš”)

### 3. ìŠ¹ë¥ ê³¼ ì†ìµë¹„ í•¨ê»˜ ë³´ê¸°
- ìŠ¹ë¥  ë†’ê³  ì†ìµë¹„ ë‚®ìŒ: ì†Œì•¡ ë‹¤ìˆ˜ ë§¤ë§¤
- ìŠ¹ë¥  ë‚®ê³  ì†ìµë¹„ ë†’ìŒ: ì†ì ˆ ì² ì €, í° ìˆ˜ìµ
- ë‘˜ ë‹¤ ë†’ìŒ: ì´ìƒì 

### 4. ê±°ë˜ íšŸìˆ˜ í™•ì¸
- ë„ˆë¬´ ë§ìŒ: ìˆ˜ìˆ˜ë£Œ ë¶€ë‹´, ê³¼ìµœì í™” ê°€ëŠ¥ì„±
- ë„ˆë¬´ ì ìŒ: ìš°ì—°ì¼ ìˆ˜ ìˆìŒ, ë” ë§ì€ ë°ì´í„° í•„ìš”

## âš ï¸ ì£¼ì˜ì‚¬í•­

### ë°±í…ŒìŠ¤íŠ¸ì˜ í•œê³„
1. **ê³¼ê±° ë°ì´í„° ê¸°ë°˜**: ë¯¸ë˜ë¥¼ ë³´ì¥í•˜ì§€ ì•ŠìŒ
2. **ê³¼ìµœì í™” ìœ„í—˜**: ê³¼ê±°ì—ë§Œ ë§ëŠ” íŒŒë¼ë¯¸í„°ì¼ ìˆ˜ ìˆìŒ
3. **ì‹¤ì œì™€ ì°¨ì´**: 
   - ìŠ¬ë¦¬í”¼ì§€ (ì‹¤ì œëŠ” ë” í´ ìˆ˜ ìˆìŒ)
   - ìœ ë™ì„± (ëŒ€ëŸ‰ ì£¼ë¬¸ ì‹œ ê°€ê²© ì˜í–¥)
   - ì‹¬ë¦¬ì  ìš”ì¸ (ì‹¤ì „ì—ì„œì˜ íŒë‹¨ ì˜¤ë¥˜)

### ë°±í…ŒìŠ¤íŠ¸ í›„ í•  ì¼
1. âœ… **ì—¬ëŸ¬ ê¸°ê°„ìœ¼ë¡œ í…ŒìŠ¤íŠ¸**: ë‹¤ì–‘í•œ ì‹œì¥ ìƒí™© ê²€ì¦
2. âœ… **ì—¬ëŸ¬ ì¢…ëª©ìœ¼ë¡œ í…ŒìŠ¤íŠ¸**: ì¼ë°˜í™” ê°€ëŠ¥ì„± í™•ì¸
3. âœ… **ëª¨ì˜íˆ¬ì ì‹¤í–‰**: ì‹¤ì‹œê°„ ë°ì´í„°ë¡œ ì¬ê²€ì¦
4. âœ… **ì†Œì•¡ ì‹¤ì „ íˆ¬ì**: ì‹¤ì œ ì‹œì¥ì—ì„œ ìµœì¢… ê²€ì¦

### ì¢‹ì€ ë°±í…ŒìŠ¤íŠ¸ ì „ëµ
- MDD < 15%
- ìƒ¤í”„ ë¹„ìœ¨ > 1.0
- ìŠ¹ë¥  > 50% ë˜ëŠ” ì†ìµë¹„ > 2.0
- ê±°ë˜ íšŸìˆ˜ > 30íšŒ (í†µê³„ì  ìœ ì˜ì„±)
- ì—¬ëŸ¬ ê¸°ê°„ì—ì„œ ì¼ê´€ëœ ì„±ê³¼

## ğŸ”§ ê³ ê¸‰ ì‚¬ìš©ë²•

### 1. ì»¤ìŠ¤í…€ ë°±í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸

```python
from trading_bot.backtest.engine import BacktestEngine
from trading_bot.backtest.report import BacktestReport
from trading_bot.strategies.ma_crossover import MovingAverageCrossover
from trading_bot.broker.kis_broker import KISBroker

# ì„¤ì •
broker = KISBroker(env_mode="demo")
strategy = MovingAverageCrossover(broker, short_period=5, long_period=20)
engine = BacktestEngine(initial_capital=10000000)

# ì‹¤í–‰ (3ê°€ì§€ ë°©ë²•)

# ë°©ë²• 1: FDR ì‚¬ìš©
results = engine.run(
    strategy=strategy,
    symbols=["005930"],
    start_date="20230101",
    end_date="20231231",
    use_fdr=True
)

# ë°©ë²• 2: KIS API ì‚¬ìš©
results = engine.run(
    strategy=strategy,
    symbols=["005930"],
    start_date="20230101",
    end_date="20231231",
    broker=broker
)

# ë°©ë²• 3: ì™¸ë¶€ DB ì‚¬ìš©
from pathlib import Path
results = engine.run(
    strategy=strategy,
    symbols=["005930"],
    start_date="20230101",
    end_date="20231231",
    db_path=Path("backtest_data.db")
)

# ê²°ê³¼ í™•ì¸
print(results['metrics'])
BacktestReport.print_summary(results)
```

### 2. ìƒˆë¡œìš´ ì „ëµ ë°±í…ŒìŠ¤íŠ¸

1. `trading_bot/strategies/`ì— ìƒˆ ì „ëµ ì‘ì„±
2. `run_backtest.py`ì—ì„œ ì „ëµ ë³€ê²½:
   ```python
   from trading_bot.strategies.my_strategy import MyStrategy
   strategy = MyStrategy(broker, param1=value1, param2=value2)
   ```

### 3. ì—¬ëŸ¬ ì¢…ëª© ë™ì‹œ ë°±í…ŒìŠ¤íŠ¸

```bash
# ëª¨ë“  Config.WATCH_LIST ì¢…ëª©
uv run run_backtest.py --source fdr --start 20220101

# íŠ¹ì • ì—¬ëŸ¬ ì¢…ëª©
uv run run_backtest.py --source fdr --symbols 005930 000660 035720 051910
```

## ğŸ“š ë‹¤ìŒ ë‹¨ê³„

ë°±í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„:
1. ğŸ“ ê²°ê³¼ ë¶„ì„ ë° íŒŒë¼ë¯¸í„° ì¡°ì •
2. ğŸ”„ ë‹¤ì–‘í•œ ì¡°ê±´ì—ì„œ ì¬í…ŒìŠ¤íŠ¸ (ì—¬ëŸ¬ ê¸°ê°„, ì—¬ëŸ¬ ì¢…ëª©)
3. ğŸ® ëª¨ì˜íˆ¬ìë¡œ ì‹¤ì‹œê°„ ê²€ì¦ (`ENV_MODE = "demo"`)
4. ğŸ’° ì†Œì•¡ ì‹¤ì „ íˆ¬ì
5. ğŸ“ˆ ì„±ê³¼ ëª¨ë‹ˆí„°ë§ ë° ì „ëµ ê°œì„ 

## ğŸ“– ê´€ë ¨ ë¬¸ì„œ

- **[backtest/QUICKSTART.md](backtest/QUICKSTART.md)** - ë°±í…ŒìŠ¤íŠ¸ ë¹ ë¥¸ ì‹œì‘
- **[backtest/DATA_SOURCES.md](backtest/DATA_SOURCES.md)** - ë°ì´í„° ì†ŒìŠ¤ ë¹„êµ ë° ì„ íƒ
- **[backtest/DB_GUIDE.md](backtest/DB_GUIDE.md)** - ì™¸ë¶€ DB ìƒì„± ê°€ì´ë“œ
- **[README.md](README.md)** - ìë™ë§¤ë§¤ ë´‡ ì „ì²´ ê°œìš”

---

**ì¤‘ìš”**: ë°±í…ŒìŠ¤íŠ¸ëŠ” ì‹œì‘ì¼ ë¿ì…ë‹ˆë‹¤. ë°˜ë“œì‹œ ëª¨ì˜íˆ¬ìì™€ ì†Œì•¡ ì‹¤ì „ìœ¼ë¡œ ê²€ì¦í•˜ì„¸ìš”!
