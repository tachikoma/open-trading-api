# ë°±í…ŒìŠ¤íŠ¸ ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ

ì´ë™í‰ê·  êµì°¨ ì „ëµì„ ê³¼ê±° ë°ì´í„°ë¡œ ë°±í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

---

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### í™˜ê²½ ë³€ìˆ˜ ë° .env íŒŒì¼

- `trading_bot/config.py`ëŠ” ì‹œìŠ¤í…œ í™˜ê²½ë³€ìˆ˜ì™€ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì˜ `.env` íŒŒì¼ì„ ì½ì–´ `ENV_MODE`ì™€ `TRADING_ENABLED` ë“±ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤. ìš°ì„ ìˆœìœ„ëŠ” ì‹œìŠ¤í…œ í™˜ê²½ë³€ìˆ˜ > `.env` > ì½”ë“œ ê¸°ë³¸ê°’ì…ë‹ˆë‹¤.
- ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹œ `TRADING_ENABLED`ê°€ `true`ë¡œ ì„¤ì •ë˜ì–´ ìˆì§€ ì•Šì€ì§€(ë˜ëŠ” `ENV_MODE`ê°€ `real`ì¸ì§€) í™•ì¸í•˜ì„¸ìš”. ê¶Œì¥ ì„¤ì •ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤:

```
ENV_MODE=demo
TRADING_ENABLED=false
```

`.env.sample` íŒŒì¼ì´ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— í¬í•¨ë˜ì–´ ìˆìœ¼ë‹ˆ, í•„ìš”í•œ ê²½ìš° ì´ë¥¼ ë³µì‚¬í•´ `.env`ë¡œ ì‚¬ìš©í•˜ì„¸ìš”.


### 1ï¸âƒ£ FinanceDataReaderë¡œ ë°±í…ŒìŠ¤íŠ¸ (ê¶Œì¥)

ë¬´ë£Œ, ë¬´ì œí•œ ë°ì´í„°ë¡œ ì¥ê¸° ë°±í…ŒìŠ¤íŠ¸:

```bash
# trading_bot í´ë”ì—ì„œ ì‹¤í–‰ (ê¶Œì¥)
cd trading_bot
uv run run_backtest.py --source fdr --start 20220101 --end 20241231

# 1ë…„ ë°±í…ŒìŠ¤íŠ¸
uv run run_backtest.py --source fdr --start 20230101

# íŠ¹ì • ì¢…ëª©ë§Œ
uv run run_backtest.py --source fdr --symbols 005930 000660 035720
```

**ì„¤ì¹˜ í•„ìš”:**
```bash
uv pip install finance-datareader
```

### 2ï¸âƒ£ KIS APIë¡œ ë°±í…ŒìŠ¤íŠ¸

ìµœê·¼ 100ê±°ë˜ì¼ ë°ì´í„°:

```bash
# trading_bot í´ë”ì—ì„œ
cd trading_bot
uv run run_backtest.py --source api

# íŠ¹ì • ê¸°ê°„ (ìµœëŒ€ 100ì¼)
uv run run_backtest.py --source api --start 20240901 --end 20241231
```

**ì„¤ì • í•„ìš”:** `kis_devlp.yaml`ì— API í‚¤ ë“±ë¡

### 3ï¸âƒ£ ì™¸ë¶€ DBë¡œ ë°±í…ŒìŠ¤íŠ¸

ì§ì ‘ ì¤€ë¹„í•œ SQLite DB ì‚¬ìš©:

```bash
# trading_bot í´ë”ì—ì„œ
cd trading_bot
uv run run_backtest.py --source db --db-path backtest_data.db --start 20200101
```

---

## ğŸ“Š ì£¼ìš” ì˜µì…˜

### ë°ì´í„° ì†ŒìŠ¤ ì„ íƒ

```bash
--source {api|db|fdr}
```

- `api`: KIS Open Trading API (ìµœëŒ€ 100ì¼)
- `db`: ì™¸ë¶€ SQLite DB (ë¬´ì œí•œ)
- `fdr`: FinanceDataReader (ë¬´ì œí•œ, ê¶Œì¥)

### ê¸°ê°„ ì„¤ì •

```bash
--start YYYYMMDD    # ì‹œì‘ì¼
--end YYYYMMDD      # ì¢…ë£Œì¼
```

ìƒëµ ì‹œ ê¸°ë³¸ê°’:
- `api`: ìµœê·¼ 100ì¼
- `db`, `fdr`: ìµœê·¼ 2ë…„

### ì¢…ëª© ì„ íƒ

```bash
--symbols 005930 000660 035720
```

ìƒëµ ì‹œ `Config.WATCH_LIST` ì‚¬ìš©

### ì „ëµ íŒŒë¼ë¯¸í„°

```bash
--short-period 5    # ë‹¨ê¸° ì´ë™í‰ê·  (ê¸°ë³¸ê°’: 5)
--long-period 20    # ì¥ê¸° ì´ë™í‰ê·  (ê¸°ë³¸ê°’: 20)
```

### ì´ˆê¸° ìë³¸ê¸ˆ

```bash
--capital 10000000  # ê¸°ë³¸ê°’: 1ì²œë§Œì›
```

### ê²°ê³¼ ì €ì¥

```bash
--output backtest_results/custom_name.png  # íŒŒì¼ëª… ì§€ì •
```

ìƒëµ ì‹œ: `backtest_results/{ì „ëµì´ë¦„}_{ë°ì´í„°ì†ŒìŠ¤}_{íƒ€ì…}_{ë‚ ì§œ}_{ì‹œê°„}.{í™•ì¥ì}`

**ì˜ˆì‹œ:**
- FDR: `backtest_results/ma_crossover_fdr_chart_20240106_143000.png`
- API: `backtest_results/ma_crossover_api_chart_20240106_143000.png`
- DB: `backtest_results/ma_crossover_db_chart_20240106_143000.png`

---

## ğŸ“– ì˜ˆì‹œ ëª…ë ¹ì–´

**ğŸ’¡ ëª¨ë“  ëª…ë ¹ì–´ëŠ” `trading_bot/` í´ë”ì—ì„œ ì‹¤í–‰í•©ë‹ˆë‹¤:**

```bash
cd trading_bot
```

### 1. ê¸°ë³¸ ë°±í…ŒìŠ¤íŠ¸ (FDR, 2ë…„)

```bash
uv run run_backtest.py
```

### 2. ì‚¼ì„±ì „ìë§Œ 5ë…„ ë°±í…ŒìŠ¤íŠ¸

```bash
uv run run_backtest.py --source fdr --symbols 005930 --start 20190101 --end 20241231
```

### 3. ì „ëµ íŒŒë¼ë¯¸í„° ì¡°ì •

```bash
# ë‹¨ê¸° 3ì¼, ì¥ê¸° 10ì¼ ì´ë™í‰ê· 
uv run run_backtest.py --source fdr --short-period 3 --long-period 10
```

### 4. ì™¸ë¶€ DB ì‚¬ìš©

```bash
# ë¨¼ì € DB ìƒì„±
uv run create_external_db.py

# ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰
uv run run_backtest.py --source db --db-path backtest_data.db
```

### 5. ìµœê·¼ 100ì¼ ë¹ ë¥¸ í…ŒìŠ¤íŠ¸

```bash
uv run run_backtest.py --source api
```

---

## ğŸ“ˆ ê²°ê³¼ í•´ì„

ë°±í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ `backtest_results/` í´ë”ì— ë‹¤ìŒ íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤:

1. **ì°¨íŠ¸ ì´ë¯¸ì§€** (PNG): `{ì „ëµì´ë¦„}_{ë°ì´í„°ì†ŒìŠ¤}_chart_{ë‚ ì§œ}_{ì‹œê°„}.png`
   - ìì‚° ê³¡ì„ , ë³´ìœ  ì¢…ëª© ìˆ˜, ëˆ„ì  ìˆ˜ìµë¥  ê·¸ë˜í”„
2. **ìì‚° ê³¡ì„ ** (CSV): `{ì „ëµì´ë¦„}_{ë°ì´í„°ì†ŒìŠ¤}_equity_{ë‚ ì§œ}_{ì‹œê°„}.csv`
   - ì¼ë³„ ìì‚° ê°€ì¹˜ ë°ì´í„°
3. **ê±°ë˜ ë‚´ì—­** (CSV): `{ì „ëµì´ë¦„}_{ë°ì´í„°ì†ŒìŠ¤}_trades_{ë‚ ì§œ}_{ì‹œê°„}.csv`
   - ëª¨ë“  ë§¤ìˆ˜/ë§¤ë„ ê±°ë˜ ìƒì„¸ ë‚´ì—­

**íŒŒì¼ ì˜ˆì‹œ:**
```
backtest_results/
â”œâ”€â”€ ma_crossover_fdr_chart_20260106_144425.png
â”œâ”€â”€ ma_crossover_fdr_equity_20260106_144425.csv
â”œâ”€â”€ ma_crossover_fdr_trades_20260106_144425.csv
â”œâ”€â”€ ma_crossover_api_chart_20260106_145030.png
â””â”€â”€ ma_crossover_db_chart_20260106_150000.png
```

**ë°ì´í„° ì†ŒìŠ¤ë³„ ë¹„êµ:**
- `fdr`: FinanceDataReader (ì¥ê¸° ë°±í…ŒìŠ¤íŠ¸)
- `api`: KIS API (ìµœê·¼ 100ì¼)
- `db`: ì™¸ë¶€ SQLite DB (ì»¤ìŠ¤í…€ ë°ì´í„°)

### ê²°ê³¼ ì˜ˆì‹œ

```
======================================================================
                              ë°±í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½                       
======================================================================

ğŸ“… ë°±í…ŒìŠ¤íŠ¸ ê¸°ê°„
  ì‹œì‘ì¼: 2022-01-03
  ì¢…ë£Œì¼: 2024-12-30

ğŸ’° ìë³¸ê¸ˆ ë° ìˆ˜ìµ
  ì´ˆê¸° ìë³¸:         10,000,000ì›
  ìµœì¢… ìë³¸:          9,742,253ì›
  ì´ ìˆ˜ìµ:             -257,747ì›
  ì´ ìˆ˜ìµë¥ :              -2.58%
  ì—°í‰ê·  ìˆ˜ìµë¥ :          -0.87%

ğŸ“Š ë¦¬ìŠ¤í¬ ì§€í‘œ
  ìµœëŒ€ ë‚™í­(MDD):          4.12%
  ìƒ¤í”„ ë¹„ìœ¨:              -1.05

ğŸ“ˆ ê±°ë˜ í†µê³„
  ì´ ê±°ë˜ íšŸìˆ˜:              85íšŒ
  ìŠ¹ë¥ :                   35.29%
  ì†ìµë¹„:                  0.78
  í‰ê·  ì†ìµ:             -3,032ì›
```

---

## ğŸ”§ ë¬¸ì œ í•´ê²°

### FinanceDataReader ì„¤ì¹˜ ì˜¤ë¥˜

```bash
âŒ FinanceDataReaderê°€ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!
```

**í•´ê²°:**
```bash
uv pip install finance-datareader
```

### DB íŒŒì¼ ì—†ìŒ

```bash
âŒ ì˜¤ë¥˜: DB íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤: /path/to/data.db
```

**í•´ê²°:**
1. ê²½ë¡œ í™•ì¸: `--db-path` ì˜µì…˜ í™•ì¸
2. DB ìƒì„±: `uv run create_external_db.py`
3. ë˜ëŠ” FDR ì‚¬ìš©: `--source fdr`

### KIS API ì¸ì¦ ì‹¤íŒ¨

```bash
âŒ ì¸ì¦ ì‹¤íŒ¨: Invalid API key
```

**í•´ê²°:**
1. `kis_devlp.yaml` íŒŒì¼ í™•ì¸
2. API í‚¤ ì¬ë°œê¸‰
3. ë˜ëŠ” FDR ì‚¬ìš©: `--source fdr`

### ê±°ë˜ ë‚´ì—­ ì—†ìŒ

```bash
âš ï¸  ê²½ê³ : ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.
```

**ì›ì¸:**
- ê¸°ê°„ì´ ë„ˆë¬´ ì§§ìŒ
- ì „ëµ ì¡°ê±´ ë¯¸ì¶©ì¡±

**í•´ê²°:**
1. ê¸°ê°„ ëŠ˜ë¦¬ê¸°: `--start 20200101`
2. ì „ëµ íŒŒë¼ë¯¸í„° ì¡°ì •: `--short-period 3 --long-period 10`
3. ì¢…ëª© ë³€ê²½: `--symbols 005930 000660`

---

## ğŸ“š ìì„¸í•œ ë¬¸ì„œ

- [ë°ì´í„° ì†ŒìŠ¤ ë¹„êµ](DATA_SOURCES.md) - ì„¸ ê°€ì§€ ë°ì´í„° ì†ŒìŠ¤ ìƒì„¸ ë¹„êµ
- [ì™¸ë¶€ DB ìƒì„±](DB_GUIDE.md) - SQLite DB ë§Œë“¤ê¸°
- [ì „ëµ ê°œë°œ ê°€ì´ë“œ](../README.md) - ìƒˆ ì „ëµ ì¶”ê°€ ë°©ë²•

---

## ğŸ’¡ íŒ

### ë¹ ë¥¸ ê²€ì¦

ë‹¨ê¸°ê°„ ë°±í…ŒìŠ¤íŠ¸ë¡œ ì „ëµ ë¹ ë¥´ê²Œ ê²€ì¦:

```bash
# ìµœê·¼ 6ê°œì›”
uv run run_backtest.py --source fdr --start 20240601
```

### íŒŒë¼ë¯¸í„° ìµœì í™”

ë‹¤ì–‘í•œ ì´ë™í‰ê·  ê¸°ê°„ í…ŒìŠ¤íŠ¸:

```bash
# 3/10
uv run run_backtest.py --short-period 3 --long-period 10

# 5/20 (ê¸°ë³¸ê°’)
uv run run_backtest.py --short-period 5 --long-period 20

# 10/50
uv run run_backtest.py --short-period 10 --long-period 50
```

### ë‹¤ì¤‘ ì¢…ëª© ë¹„êµ

ê°œë³„ ì¢…ëª© vs í¬íŠ¸í´ë¦¬ì˜¤:

```bash
# ì‚¼ì„±ì „ìë§Œ
uv run run_backtest.py --symbols 005930

# í¬íŠ¸í´ë¦¬ì˜¤
uv run run_backtest.py --symbols 005930 000660 035720 035420
```

---

## âš¡ ì„±ëŠ¥ ë¹„êµ

| ë°ì´í„° ì†ŒìŠ¤ | ì†ë„ | ê¸°ê°„ ì œí•œ | ì¸í„°ë„· | ì¶”ì²œ |
|------------|------|----------|--------|------|
| **api** | ëŠë¦¼ | 100ì¼ | í•„ìš” | âŒ |
| **db** | ë¹ ë¦„ | ì—†ìŒ | ë¶ˆí•„ìš” | â­ (ì˜¤í”„ë¼ì¸) |
| **fdr** | ë³´í†µ | ì—†ìŒ | í•„ìš” | â­â­ (ê¶Œì¥) |

**ê¶Œì¥ ì‚¬ìš©ë²•:**
- ê°œë°œ/í…ŒìŠ¤íŠ¸: `fdr` (ê°„í¸)
- í”„ë¡œë•ì…˜: `db` (ë¹ ë¦„)
- ë‹¨ê¸° ê²€ì¦: `api` (ì„¤ì¹˜ ë¶ˆí•„ìš”)
